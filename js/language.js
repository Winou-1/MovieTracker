const translations = {
    fr: {
        // Navigation
        nav_films: 'Films',
        nav_discover: 'D√©couvrir',
        nav_watchlist: 'Watchlist',
        nav_watched: 'Films vus',
        nav_profile: 'Profil',
        
        // Auth
        auth_login: 'Connexion',
        auth_register: 'Inscription',
        auth_username: "Nom d'utilisateur",
        auth_email: 'Email',
        auth_password: 'Mot de passe',
        auth_signin: 'Se connecter',
        auth_signup: "S'inscrire",
        auth_no_account: 'Pas encore de compte ?',
        auth_have_account: 'D√©j√† inscrit ?',
        auth_forgot_password: 'Mot de passe oubli√© ?',
        auth_logout: 'D√©connexion',
        
        // Search
        search_title: 'D√©couvre et note tes films pr√©f√©r√©s',
        search_placeholder: 'Rechercher un film...',
        search_button: 'Rechercher',
        
        // Movies
        movies_popular: 'Films populaires',
        movies_loading: 'Chargement...',
        movies_error: 'Erreur lors du chargement des films',
        movies_no_results: 'Aucun film trouv√©',
        movies_watchlist_badge: '√Ä voir',
        movies_watched_badge: 'Vu',
        
        // Profile
        profile_title: 'Mon Profil',
        profile_edit_username: 'Modifier le pseudo',
        profile_stats_watched: 'Films vus',
        profile_stats_month: 'Ce mois',
        profile_stats_time: 'Temps total',
        profile_stats_average: 'Note moy.',
        profile_stats_reviews: 'Avis',
        profile_stats_favorites: 'Favoris',
        profile_stats_watchlist: '√Ä voir',
        profile_liked: 'Films aim√©s',
        profile_to_watch: '√Ä voir',
        profile_recently_watched: 'Vus r√©cemment',
        profile_no_movies: 'Aucun film pour le moment',
        profile_explore: 'Explorez et ajoutez des films !',
        profile_see_all: 'Voir tout',
        
        // Settings
        settings_title: 'Param√®tres',
        settings_profile: 'Profil',
        settings_avatar: 'Photo de profil',
        settings_avatar_edit: 'Modifier votre avatar',
        settings_username: 'Pseudo',
        settings_email: 'Email',
        settings_password: 'Mot de passe',
        settings_preferences: 'Pr√©f√©rences',
        settings_notifications: 'Notifications',
        settings_notifications_desc: 'Recevoir les alertes',
        settings_language: 'Langue',
        settings_danger_zone: 'Zone dangereuse',
        settings_logout: 'D√©connexion',
        settings_delete_account: 'Supprimer mon compte',
        
        // Modal Movie
        modal_year: 'Ann√©e',
        modal_runtime: 'min',
        modal_rating: 'Note',
        modal_synopsis: 'Synopsis',
        modal_cast: 'Casting',
        modal_similar: 'Vous aimerez aussi',
        modal_collection: 'Autres films de la saga',
        modal_no_synopsis: 'Pas de synopsis disponible.',
        
        // Actions
        action_trailer: 'Bande-annonce',
        action_watched: 'Vu',
        action_watchlist: 'Watchlist',
        action_skip: 'Passer',
        action_save: 'Enregistrer',
        action_cancel: 'Annuler',
        action_validate: 'Valider',
        action_close: 'Fermer',
        
        // Filters
        filter_sort: 'Trier par :',
        filter_genre: 'Genre :',
        filter_all_genres: 'Tous les genres',
        filter_grid_size: 'Affiches par ligne :',
        filter_reset: 'R√©initialiser',
        filter_title_asc: 'Titre (A ‚Üí Z)',
        filter_title_desc: 'Titre (Z ‚Üí A)',
        filter_date_asc: 'Date de sortie (croissant)',
        filter_date_desc: 'Date de sortie (d√©croissant)',
        filter_added_desc: 'R√©cemment ajout√©',
        
        // Toasts
        toast_added_watchlist: 'Ajout√© √† la watchlist',
        toast_removed_watchlist: 'Retir√© de la watchlist',
        toast_marked_watched: 'Marqu√© comme vu',
        toast_removed_watched: 'Retir√© des films vus',
        toast_login_success: 'Connexion r√©ussie !',
        toast_logout_success: 'D√©connexion r√©ussie',
        toast_profile_updated: 'Profil mis √† jour !',
        toast_error: 'Erreur',
        
        // Months
        month_january: 'janvier',
        month_february: 'f√©vrier',
        month_march: 'mars',
        month_april: 'avril',
        month_may: 'mai',
        month_june: 'juin',
        month_july: 'juillet',
        month_august: 'ao√ªt',
        month_september: 'septembre',
        month_october: 'octobre',
        month_november: 'novembre',
        month_december: 'd√©cembre'
    },
    en: {
        // Navigation
        nav_films: 'Movies',
        nav_discover: 'Discover',
        nav_watchlist: 'Watchlist',
        nav_watched: 'Watched',
        nav_profile: 'Profile',
        
        // Auth
        auth_login: 'Login',
        auth_register: 'Sign Up',
        auth_username: 'Username',
        auth_email: 'Email',
        auth_password: 'Password',
        auth_signin: 'Sign In',
        auth_signup: 'Sign Up',
        auth_no_account: "Don't have an account?",
        auth_have_account: 'Already registered?',
        auth_forgot_password: 'Forgot password?',
        auth_logout: 'Logout',
        
        // Search
        search_title: 'Discover and rate your favorite movies',
        search_placeholder: 'Search for a movie...',
        search_button: 'Search',
        
        // Movies
        movies_popular: 'Popular Movies',
        movies_loading: 'Loading...',
        movies_error: 'Error loading movies',
        movies_no_results: 'No movies found',
        movies_watchlist_badge: 'To Watch',
        movies_watched_badge: 'Watched',
        
        // Profile
        profile_title: 'My Profile',
        profile_edit_username: 'Edit username',
        profile_stats_watched: 'Watched',
        profile_stats_month: 'This month',
        profile_stats_time: 'Total time',
        profile_stats_average: 'Avg rating',
        profile_stats_reviews: 'Reviews',
        profile_stats_favorites: 'Favorites',
        profile_stats_watchlist: 'To Watch',
        profile_liked: 'Liked Movies',
        profile_to_watch: 'To Watch',
        profile_recently_watched: 'Recently Watched',
        profile_no_movies: 'No movies yet',
        profile_explore: 'Explore and add movies!',
        profile_see_all: 'See all',
        
        // Settings
        settings_title: 'Settings',
        settings_profile: 'Profile',
        settings_avatar: 'Profile picture',
        settings_avatar_edit: 'Edit your avatar',
        settings_username: 'Username',
        settings_email: 'Email',
        settings_password: 'Password',
        settings_preferences: 'Preferences',
        settings_notifications: 'Notifications',
        settings_notifications_desc: 'Receive alerts',
        settings_language: 'Language',
        settings_danger_zone: 'Danger Zone',
        settings_logout: 'Logout',
        settings_delete_account: 'Delete my account',
        
        // Modal Movie
        modal_year: 'Year',
        modal_runtime: 'min',
        modal_rating: 'Rating',
        modal_synopsis: 'Synopsis',
        modal_cast: 'Cast',
        modal_similar: 'You might also like',
        modal_collection: 'Other movies in the saga',
        modal_no_synopsis: 'No synopsis available.',
        
        // Actions
        action_trailer: 'Trailer',
        action_watched: 'Watched',
        action_watchlist: 'Watchlist',
        action_skip: 'Skip',
        action_save: 'Save',
        action_cancel: 'Cancel',
        action_validate: 'Validate',
        action_close: 'Close',
        
        // Filters
        filter_sort: 'Sort by:',
        filter_genre: 'Genre:',
        filter_all_genres: 'All genres',
        filter_grid_size: 'Posters per row:',
        filter_reset: 'Reset',
        filter_title_asc: 'Title (A ‚Üí Z)',
        filter_title_desc: 'Title (Z ‚Üí A)',
        filter_date_asc: 'Release date (ascending)',
        filter_date_desc: 'Release date (descending)',
        filter_added_desc: 'Recently added',
        
        // Toasts
        toast_added_watchlist: 'Added to watchlist',
        toast_removed_watchlist: 'Removed from watchlist',
        toast_marked_watched: 'Marked as watched',
        toast_removed_watched: 'Removed from watched',
        toast_login_success: 'Login successful!',
        toast_logout_success: 'Logged out successfully',
        toast_profile_updated: 'Profile updated!',
        toast_error: 'Error',
        
        // Months
        month_january: 'January',
        month_february: 'February',
        month_march: 'March',
        month_april: 'April',
        month_may: 'May',
        month_june: 'June',
        month_july: 'July',
        month_august: 'August',
        month_september: 'September',
        month_october: 'October',
        month_november: 'November',
        month_december: 'December'
    },
    es: {
        // Navigation
        nav_films: 'Pel√≠culas',
        nav_discover: 'Descubrir',
        nav_watchlist: 'Lista',
        nav_watched: 'Vistas',
        nav_profile: 'Perfil',
        
        // Auth
        auth_login: 'Iniciar sesi√≥n',
        auth_register: 'Registrarse',
        auth_username: 'Nombre de usuario',
        auth_email: 'Correo',
        auth_password: 'Contrase√±a',
        auth_signin: 'Entrar',
        auth_signup: 'Registrarse',
        auth_no_account: '¬øNo tienes cuenta?',
        auth_have_account: '¬øYa registrado?',
        auth_forgot_password: '¬øOlvidaste tu contrase√±a?',
        auth_logout: 'Cerrar sesi√≥n',
        
        // Search
        search_title: 'Descubre y califica tus pel√≠culas favoritas',
        search_placeholder: 'Buscar una pel√≠cula...',
        search_button: 'Buscar',
        
        // Movies
        movies_popular: 'Pel√≠culas Populares',
        movies_loading: 'Cargando...',
        movies_error: 'Error al cargar pel√≠culas',
        movies_no_results: 'No se encontraron pel√≠culas',
        movies_watchlist_badge: 'Por Ver',
        movies_watched_badge: 'Vista',
        
        // Profile
        profile_title: 'Mi Perfil',
        profile_edit_username: 'Editar nombre',
        profile_stats_watched: 'Vistas',
        profile_stats_month: 'Este mes',
        profile_stats_time: 'Tiempo total',
        profile_stats_average: 'Nota media',
        profile_stats_reviews: 'Rese√±as',
        profile_stats_favorites: 'Favoritas',
        profile_stats_watchlist: 'Por Ver',
        profile_liked: 'Pel√≠culas Favoritas',
        profile_to_watch: 'Por Ver',
        profile_recently_watched: 'Vistas Recientemente',
        profile_no_movies: 'A√∫n no hay pel√≠culas',
        profile_explore: '¬°Explora y a√±ade pel√≠culas!',
        profile_see_all: 'Ver todo',
        
        // Settings
        settings_title: 'Configuraci√≥n',
        settings_profile: 'Perfil',
        settings_avatar: 'Foto de perfil',
        settings_avatar_edit: 'Editar tu avatar',
        settings_username: 'Nombre',
        settings_email: 'Correo',
        settings_password: 'Contrase√±a',
        settings_preferences: 'Preferencias',
        settings_notifications: 'Notificaciones',
        settings_notifications_desc: 'Recibir alertas',
        settings_language: 'Idioma',
        settings_danger_zone: 'Zona Peligrosa',
        settings_logout: 'Cerrar sesi√≥n',
        settings_delete_account: 'Eliminar mi cuenta',
        
        // Modal Movie
        modal_year: 'A√±o',
        modal_runtime: 'min',
        modal_rating: 'Nota',
        modal_synopsis: 'Sinopsis',
        modal_cast: 'Reparto',
        modal_similar: 'Tambi√©n te gustar√°',
        modal_collection: 'Otras pel√≠culas de la saga',
        modal_no_synopsis: 'Sin sinopsis disponible.',
        
        // Actions
        action_trailer: 'Tr√°iler',
        action_watched: 'Vista',
        action_watchlist: 'Lista',
        action_skip: 'Saltar',
        action_save: 'Guardar',
        action_cancel: 'Cancelar',
        action_validate: 'Validar',
        action_close: 'Cerrar',
        
        // Filters
        filter_sort: 'Ordenar por:',
        filter_genre: 'G√©nero:',
        filter_all_genres: 'Todos los g√©neros',
        filter_grid_size: 'P√≥sters por fila:',
        filter_reset: 'Restablecer',
        filter_title_asc: 'T√≠tulo (A ‚Üí Z)',
        filter_title_desc: 'T√≠tulo (Z ‚Üí A)',
        filter_date_asc: 'Fecha de estreno (ascendente)',
        filter_date_desc: 'Fecha de estreno (descendente)',
        filter_added_desc: 'A√±adido recientemente',
        
        // Toasts
        toast_added_watchlist: 'A√±adido a la lista',
        toast_removed_watchlist: 'Eliminado de la lista',
        toast_marked_watched: 'Marcado como vista',
        toast_removed_watched: 'Eliminado de vistas',
        toast_login_success: '¬°Inicio de sesi√≥n exitoso!',
        toast_logout_success: 'Sesi√≥n cerrada',
        toast_profile_updated: '¬°Perfil actualizado!',
        toast_error: 'Error',
        
        // Months
        month_january: 'enero',
        month_february: 'febrero',
        month_march: 'marzo',
        month_april: 'abril',
        month_may: 'mayo',
        month_june: 'junio',
        month_july: 'julio',
        month_august: 'agosto',
        month_september: 'septiembre',
        month_october: 'octubre',
        month_november: 'noviembre',
        month_december: 'diciembre'
    }
};

// Langue actuelle (par d√©faut fran√ßais)
let currentLanguage = localStorage.getItem('app_language') || 'fr';

// Fonction pour obtenir une traduction
function t(key) {
    return translations[currentLanguage][key] || key;
}

// Fonction pour changer la langue
function changeLanguage(lang) {
    if (!translations[lang]) {
        console.error('Langue non support√©e:', lang);
        return;
    }
    
    currentLanguage = lang;
    localStorage.setItem('app_language', lang);
    
    // Mettre √† jour l'interface
    updateUILanguage();
    
    // Recharger les donn√©es si n√©cessaire
    if (state.currentView === 'profile') {
        initProfile();
    }
    
    showToast(t('toast_profile_updated'));
}

// Fonction pour mettre √† jour toute l'interface
function updateUILanguage() {
    // Navigation desktop
    const navFilms = document.getElementById('navFilms');
    const navSwiper = document.getElementById('navSwiper');
    const navWatchlist = document.getElementById('navWatchlist');
    const navWatched = document.getElementById('navWatched');
    const navProfile = document.getElementById('navProfile');
    
    if (navFilms) navFilms.textContent = t('nav_films');
    if (navSwiper) navSwiper.textContent = t('nav_discover');
    if (navWatchlist) navWatchlist.textContent = t('nav_watchlist');
    if (navWatched) navWatched.textContent = t('nav_watched');
    if (navProfile) navProfile.textContent = t('nav_profile');
    
    // Auth buttons
    const loginBtn = document.getElementById('loginBtn');
    const registerBtn = document.getElementById('registerBtn');
    
    if (loginBtn) loginBtn.textContent = t('auth_login');
    if (registerBtn) registerBtn.textContent = t('auth_register');
    
    // Search section
    const searchTitle = document.querySelector('.search-section h1');
    const searchInput = document.getElementById('searchInput');
    const searchBtn = document.getElementById('searchBtn');
    
    if (searchTitle) searchTitle.textContent = t('search_title');
    if (searchInput) searchInput.placeholder = t('search_placeholder');
    if (searchBtn) searchBtn.textContent = t('search_button');
    
    // Section titles
    const moviesSectionTitle = document.querySelector('#moviesSection .section-title');
    if (moviesSectionTitle) moviesSectionTitle.textContent = t('movies_popular');
    
    // Mettre √† jour la vue actuelle
    switch(state.currentView) {
        case 'movies':
            break;
        case 'watchlist':
            break;
        case 'watched':
            break;
        case 'profile':
            const profileTitle = document.querySelector('.title');
            if (profileTitle) profileTitle.textContent = t('profile_title');
            break;
    }
}

// Fonction pour ouvrir le modal de s√©lection de langue
function openLanguageModal() {
    const currentLang = currentLanguage;
    
    const modal = document.createElement('div');
    modal.className = 'settings-modal active';
    modal.id = 'languageModal';
    modal.innerHTML = `
        <div class="settings-content" style="max-width: 400px; margin: auto; border-radius: 24px;">
            <div class="settings-handle"></div>
            <div class="settings-header">
                <div class="settings-header-top">
                    <h2 class="settings-title">${t('settings_language')}</h2>
                    <button class="settings-close-btn" onclick="closeLanguageModal()">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="6" x2="6" y2="18"/>
                            <line x1="6" y1="6" x2="18" y2="18"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="settings-body">
                <div class="language-options">
                    <div class="language-option ${currentLang === 'fr' ? 'active' : ''}" onclick="selectLanguage('fr')">
                        <span class="language-flag">üá´üá∑</span>
                        <span class="language-name">Fran√ßais</span>
                        ${currentLang === 'fr' ? '<span class="language-check">‚úì</span>' : ''}
                    </div>
                    <div class="language-option ${currentLang === 'en' ? 'active' : ''}" onclick="selectLanguage('en')">
                        <span class="language-flag">üá¨üáß</span>
                        <span class="language-name">English</span>
                        ${currentLang === 'en' ? '<span class="language-check">‚úì</span>' : ''}
                    </div>
                    <div class="language-option ${currentLang === 'es' ? 'active' : ''}" onclick="selectLanguage('es')">
                        <span class="language-flag">üá™üá∏</span>
                        <span class="language-name">Espa√±ol</span>
                        ${currentLang === 'es' ? '<span class="language-check">‚úì</span>' : ''}
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Ajouter les styles
    const style = document.createElement('style');
    style.textContent = `
        .language-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .language-option {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--bg-elevated);
            border: 2px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .language-option:hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .language-option.active {
            background: rgba(59, 130, 246, 0.15);
            border-color: var(--primary);
        }
        
        .language-flag {
            font-size: 28px;
        }
        
        .language-name {
            flex: 1;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .language-check {
            font-size: 20px;
            color: var(--primary);
            font-weight: bold;
        }
    `;
    
    document.head.appendChild(style);
    document.body.appendChild(modal);
    document.body.style.overflow = 'hidden';
}

function closeLanguageModal() {
    const modal = document.getElementById('languageModal');
    if (modal) {
        modal.remove();
        document.body.style.overflow = '';
    }
}

function selectLanguage(lang) {
    changeLanguage(lang);
    closeLanguageModal();
    const settingsModal = document.getElementById('settingsModal');
    if (settingsModal && settingsModal.classList.contains('active')) {
        setTimeout(() => {
            closeSettings();
            setTimeout(() => {
                createSettingsModal();
                openSettings();
            }, 100);
        }, 300);
    }
}
window.t = t;
window.changeLanguage = changeLanguage;
window.openLanguageModal = openLanguageModal;
window.closeLanguageModal = closeLanguageModal;
window.selectLanguage = selectLanguage;
document.addEventListener('DOMContentLoaded', () => {
    updateUILanguage();
});